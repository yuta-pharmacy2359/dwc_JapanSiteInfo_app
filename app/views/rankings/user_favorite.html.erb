<div class="container px-5 my-5 px-sm-0">

  <h3 class="mb-5">いいね数ランキング(ユーザー)</h3>

  <p class="my-5">
    スポットのいいね数ランキングは
    <%= link_to "こちら", spot_favorite_ranking_path %>
  </p>

  <% if @summary.count < 11 %>
    <div class="now-preparation mb-5 text-center">現在準備中です。</div>
    <div class="now-preparation-image"><img src="<%= asset_path "398656.jpg" %>" class="now-preparation-image-img"></div>
  <% else %>
    <div class="mb-5">
      <table class="table user-favorite-ranking">
        <thead>
          <tr>
            <td>順位</td>
            <td></td>
            <td>ニックネーム</td>
            <td>住所</td>
            <td>年齢</td>
            <td>スポット数</td>
            <td>総いいね数</td>
          </tr>
        </thead>
        <tbody>
          <% lastFavorite = 0 %>
          <% j = 1 %>
          <% @summary.sort{|(k1, v1),(k2, v2)| v2 <=> v1 }.to_h.each.with_index(1) do |(k, v), i| %>
            <% break if j > 10 %>
            <% if i == 1 %>
              <% lastFavorite = v %>
            <% end %>
            <tr>
              <% if v != lastFavorite %>
                <% j = i %>
                <td class="text-nowrap">第<%= j.to_s %>位</td>
                <td><%= attachment_image_tag User.find(k.to_i), :profile_image, format: "jpeg", fallback: "noimage-1-760x460.png", class: "image-150" %></td>
                <td>
                  <%= link_to user_path(User.find(k.to_i)) do %>
                    <%= User.find(k.to_i).nickname %>
                  <% end %>
                </td>
                <td><%= User.find(k.to_i).prefecture %><%= User.find(k.to_i).city %></td>
                <td class="text-nowrap"><%= User.find(k.to_i).age %>歳</td>
                <td class="text-nowrap"><%= User.find(k.to_i).spots.count %>スポット</td>
                <td class="text-nowrap"><span class="fa fa-heart unlikebtn mr-1"></span><%= v.to_s %></td>
                <% lastFavorite = v %>
              <% else %>
                <% lastFavorite = v %>
                <td class="text-nowrap">第<%= j.to_s %>位</td>
                <td><%= attachment_image_tag User.find(k.to_i), :profile_image, format: "jpeg", fallback: "noimage-1-760x460.png", class: "image-150" %></td>
                <td>
                  <%= link_to user_path(User.find(k.to_i)) do %>
                    <%= User.find(k.to_i).nickname %>
                  <% end %>
                </td>
                <td><%= User.find(k.to_i).prefecture %><%= User.find(k.to_i).city %></td>
                <td class="text-nowrap"><%= User.find(k.to_i).age %>歳</td>
                <td class="text-nowrap"><%= User.find(k.to_i).spots.count %>スポット</td>
                <td class="text-nowrap"><span class="fa fa-heart unlikebtn mr-1"></span><%= v.to_s %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>