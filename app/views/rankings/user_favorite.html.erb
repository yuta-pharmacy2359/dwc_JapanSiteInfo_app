<div class="container px-5 my-5 px-sm-0">

  <h3 class="mb-5">いいね数ランキング(ユーザー)</h3>

  <div class="mb-5">
    <table class="table user-favorite-ranking">
      <thead>
        <tr>
          <td>順位</td>
          <td></td>
          <td>ニックネーム</td>
          <td>住所</td>
          <td>年齢</td>
          <td>スポット数</td>
          <td>総いいね数</td>
        </tr>
      </thead>
      <tbody>
        <% lastFavorite = 0 %>
        <% j = 1 %>
        <% @summary.each.with_index(1) do |(k, v), i| %>
          <% if i == 1 %>
            <% lastFavorite = v %>
          <% end %>
          <tr>
            <% if v != lastFavorite %>
              <% j = i %>
              <td>第<%= j.to_s %>位</td>
              <td><%= attachment_image_tag User.find(k.to_i), :profile_image, format: "jpeg", fallback: "noimage-1-760x460.png", class: "profile-image-100px" %></td>
              <td>
                <%= link_to user_path(User.find(k.to_i)) do %>
                  <%= User.find(k.to_i).nickname %>
                <% end %>
              </td>
              <td><%= User.find(k.to_i).prefecture %><%= User.find(k.to_i).city %></td>
              <td><%= User.find(k.to_i).age %>歳</td>
              <td><%= User.find(k.to_i).spots.count %>スポット</td>
              <td class="text-nowrap"><span class="fa fa-heart like-btn-unlike mr-1"></span><%= v.to_s %></td>
              <% lastFavorite = v %>
            <% else %>
              <% lastFavorite = v %>
              <td>第<%= j.to_s %>位</td>
              <td><%= attachment_image_tag User.find(k.to_i), :profile_image, format: "jpeg", fallback: "noimage-1-760x460.png", class: "profile-image-100px" %></td>
              <td>
                <%= link_to user_path(User.find(k.to_i)) do %>
                  <%= User.find(k.to_i).nickname %>
                <% end %>
              </td>
              <td><%= User.find(k.to_i).prefecture %><%= User.find(k.to_i).city %></td>
              <td><%= User.find(k.to_i).age %>歳</td>
              <td><%= User.find(k.to_i).spots.count %>スポット</td>
              <td class="text-nowrap"><span class="fa fa-heart like-btn-unlike mr-1"></span><%= v.to_s %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%#= paginate @user_favorite_index, theme: 'twitter-bootstrap-4' %>
</div>